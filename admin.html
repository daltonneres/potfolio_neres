<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerenciador de Leads</title>
    <link rel="icon" href="favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-body { padding: 40px; background: #000; color: white; }
        .header-admin { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #3498db; padding-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: #111; }
        th, td { text-align: left; padding: 15px; border-bottom: 1px solid #222; }
        th { background: #3498db; color: #000; }
        .badge { padding: 5px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-visita { background: #555; color: white; }
        .badge-interesse { background: #27ae60; color: white; }
    </style>
</head>
<body class="admin-body">
    <div class="header-admin">
        <h1>Leads do Portfólio</h1>

        <div style="display: flex; gap: 10px;">
            <a href="index.html" class="btn-secondary" style="padding: 10px 20px; text-decoration: none;">
                Início
            </a>
            <button onclick="logout()" class="btn-secondary" style="padding: 10px 20px;">
                Sair
            </button>
        </div>
    </div>

    <table id="tabelaLeads">
        <thead>
            <tr>
                <th>Data</th>
                <th>Nome</th>
                <th>Status/Tipo</th>
                <th>WhatsApp</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD-7iM7QKN8bKYY8CLm4df8wbyA1qvUZxw",
            authDomain: "leadsportfolio-c4815.firebaseapp.com",
            projectId: "leadsportfolio-c4815",
            storageBucket: "leadsportfolio-c4815.firebasestorage.app",
            messagingSenderId: "293134787082",
            appId: "1:293134787082:web:73d7343134325733f2b5f3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Proteção de Rota
        onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "login.html";
        });

        window.logout = () => {
            signOut(auth).then(() => window.location.href = "login.html");
        };

        // Carregar Leads em Tempo Real
        const q = query(collection(db, "leads"), orderBy("dataCriacao", "desc"));
        onSnapshot(q, (snapshot) => {
            const tbody = document.querySelector("#tabelaLeads tbody");
            tbody.innerHTML = "";
            
            snapshot.forEach((doc) => {
                const lead = doc.data();
                const data = lead.dataCriacao?.toDate().toLocaleString('pt-BR') || "Aguardando...";
                const classeBadge = lead.tipo === 'Interesse' ? 'badge-interesse' : 'badge-visita';

                tbody.innerHTML += `
                    <tr>
                        <td>${data}</td>
                        <td>${lead.nome}</td>
                        <td><span class="badge ${classeBadge}">${lead.tipo}</span></td>
                        <td>${lead.telefone || '---'}</td>
                    </tr>
                `;
            });
        });
    </script>

<!-- Rodapé -->
<footer class="footer">
  <p class="rodape-final">
    © <span id="anoAtual"></span> Desenvolvido por
    <a href="https://github.com/daltonneres" target="_blank" style="color: #fff; text-decoration: none;">
      Dalton Neres - Full Stack Developer
    </a>
    <br>
    Todos os direitos reservados.
  </p>
</footer>

<script>
  document.getElementById("anoAtual").textContent = new Date().getFullYear();
</script>

</body>
</html>